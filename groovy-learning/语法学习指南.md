# Groovy语法学习指南 🚀

欢迎来到Groovy语法学习指南！本文档将带您从零基础成长为Groovy开发专家。

## 📋 学习目录

- [第1章 基础语法](#第1章-基础语法)
- [第2章 数据类型](#第2章-数据类型)
- [第3章 控制结构](#第3章-控制结构)
- [第4章 集合操作](#第4章-集合操作)
- [第5章 函数与闭包](#第5章-函数与闭包)
- [第6章 面向对象编程](#第6章-面向对象编程)
- [第7章 元编程](#第7章-元编程)
- [第8章 字符串处理](#第8章-字符串处理)
- [第9章 文件操作](#第9章-文件操作)
- [第10章 正则表达式](#第10章-正则表达式)
- [第11章 构建器模式](#第11章-构建器模式)
- [第12章 JSON和XML处理](#第12章-json和xml处理)
- [第13章 数据库操作](#第13章-数据库操作)
- [第14章 Web开发](#第14章-web开发)
- [第15章 测试框架](#第15章-测试框架)
- [第16章 Gradle构建](#第16章-gradle构建)
- [第17章 高级特性](#第17章-高级特性)

---

## 第1章 基础语法

### 1.1 变量声明

```groovy
// 动态类型（推荐）
def name = "张三"
def age = 25
def isStudent = true

// 静态类型
String fullName = "张三丰"
int score = 95
boolean passed = true

// 常量
final PI = 3.14159
```

### 1.2 输出和输入

```groovy
// 输出
println "Hello World!"
print "不换行输出"

// 字符串插值
def name = "小明"
println "你好，${name}！"
println "你好，$name！"  // 简写形式

// 多行字符串
def text = """
这是一个
多行字符串
"""
```

### 1.3 注释

```groovy
// 单行注释

/*
 * 多行注释
 * 用于详细说明
 */

/**
 * 文档注释
 * @param name 参数说明
 * @return 返回值说明
 */
```

---

## 第2章 数据类型

### 2.1 基本数据类型

```groovy
// 数字类型
def intNum = 42
def longNum = 42L
def floatNum = 3.14f
def doubleNum = 3.14159
def bigIntNum = 123456789012345678901234567890G
def bigDecimalNum = 3.141592653589793238462643383279502884197G

// 字符串类型
def singleQuote = '单引号字符串'
def doubleQuote = "双引号字符串"
def tripleQuote = '''三重引号
多行字符串'''

// 布尔类型
def isTrue = true
def isFalse = false

// 检查类型
println intNum.class
println "字符串".class
```

### 2.2 类型转换

```groovy
// 自动转换
def result = "42" as Integer
def number = 42 as String

// 显式转换
def str = "123"
def num = Integer.parseInt(str)
def decimal = Double.parseDouble("3.14")

// 安全转换
def value = "abc"
def safeNum = value.isNumber() ? value as Integer : 0
```

---

## 第3章 控制结构

### 3.1 条件语句

```groovy
// if-else语句
def score = 85
if (score >= 90) {
    println "优秀"
} else if (score >= 80) {
    println "良好"
} else if (score >= 60) {
    println "及格"
} else {
    println "不及格"
}

// 三元操作符
def result = score >= 60 ? "通过" : "未通过"

// Elvis操作符（空值处理）
def name = null
def displayName = name ?: "匿名用户"

// switch语句（增强版）
def grade = 'B'
switch (grade) {
    case 'A':
        println "优秀"
        break
    case ['B', 'C']:  // 多值匹配
        println "良好"
        break
    case ~/D|F/:      // 正则匹配
        println "需要努力"
        break
    default:
        println "无效等级"
}
```

### 3.2 循环语句

```groovy
// for循环
for (i in 1..5) {
    println "数字: $i"
}

// for-each循环
def fruits = ["苹果", "香蕉", "橘子"]
for (fruit in fruits) {
    println "水果: $fruit"
}

// while循环
def i = 0
while (i < 5) {
    println "计数: $i"
    i++
}

// 集合迭代方法
fruits.each { fruit ->
    println "水果: $fruit"
}

// 带索引的迭代
fruits.eachWithIndex { fruit, index ->
    println "$index: $fruit"
}
```

---

## 第4章 集合操作

### 4.1 List列表

```groovy
// 创建列表
def numbers = [1, 2, 3, 4, 5]
def mixedList = [1, "hello", true, 3.14]
def emptyList = []

// 列表操作
numbers << 6           // 添加元素
numbers += [7, 8]      // 添加多个元素
println numbers[0]     // 访问元素
println numbers[-1]    // 最后一个元素
println numbers[1..3]  // 子列表

// 列表方法
def doubled = numbers.collect { it * 2 }  // 映射
def evens = numbers.findAll { it % 2 == 0 }  // 过滤
def sum = numbers.sum()  // 求和
def max = numbers.max()  // 最大值

// 实用方法
println numbers.join(", ")  // 连接为字符串
numbers.sort()              // 排序
numbers.reverse()           // 反转
```

### 4.2 Map字典

```groovy
// 创建Map
def person = [name: "张三", age: 25, city: "北京"]
def emptyMap = [:]

// 访问和修改
println person.name        // 点号访问
println person['age']      // 方括号访问
person.job = "程序员"      // 添加新键值对
person['salary'] = 10000

// Map方法
person.each { key, value ->
    println "$key: $value"
}

def keys = person.keySet()
def values = person.values()
def hasKey = person.containsKey('name')

// 合并Map
def additional = [hobby: "编程", status: "单身"]
def merged = person + additional
```

### 4.3 Set集合

```groovy
// 创建Set
def uniqueNumbers = [1, 2, 3, 3, 4, 4] as Set
def colors = ["红", "绿", "蓝"] as Set

// Set操作
colors << "黄"           // 添加元素
colors.remove("绿")     // 删除元素
def hasRed = colors.contains("红")

// 集合运算
def set1 = [1, 2, 3] as Set
def set2 = [3, 4, 5] as Set
def intersection = set1.intersect(set2)  // 交集
def union = set1.plus(set2)              // 并集
def difference = set1.minus(set2)        // 差集
```

---

## 第5章 函数与闭包

### 5.1 函数定义

```groovy
// 简单函数
def sayHello() {
    println "Hello!"
}

// 带参数的函数
def greet(name) {
    println "Hello, $name!"
}

// 带默认参数的函数
def createUser(name, age = 18, city = "北京") {
    return [name: name, age: age, city: city]
}

// 返回值
def add(a, b) {
    a + b  // 最后一行自动返回
}

// 调用函数
sayHello()
greet("张三")
def user = createUser("李四", 25)
def result = add(10, 20)
```

### 5.2 闭包基础

```groovy
// 创建闭包
def sayGoodbye = { name ->
    println "Goodbye, $name!"
}

def multiply = { a, b ->
    a * b
}

// 调用闭包
sayGoodbye("张三")
sayGoodbye.call("李四")
println multiply(5, 6)

// 单参数闭包（使用it）
def square = { it * it }
println square(5)

// 无参数闭包
def getCurrentTime = {
    new Date()
}
println getCurrentTime()
```

### 5.3 闭包高级用法

```groovy
// 闭包作为参数
def calculate(a, b, operation) {
    operation(a, b)
}

println calculate(10, 5, { x, y -> x + y })  // 加法
println calculate(10, 5) { x, y -> x * y }   // 乘法（简写）

// 列表的闭包方法
def numbers = [1, 2, 3, 4, 5]

// each - 遍历
numbers.each { println "数字: $it" }

// collect - 映射转换
def squares = numbers.collect { it * it }

// findAll - 过滤
def evens = numbers.findAll { it % 2 == 0 }

// find - 查找第一个
def firstEven = numbers.find { it % 2 == 0 }

// any - 任意匹配
def hasLarge = numbers.any { it > 3 }

// every - 全部匹配
def allPositive = numbers.every { it > 0 }
```

---

## 第6章 面向对象编程

### 6.1 类和对象

```groovy
// 定义类
class Person {
    String name
    int age
    String city = "北京"  // 默认值
    
    // 构造函数
    Person(name, age) {
        this.name = name
        this.age = age
    }
    
    // 方法
    def introduce() {
        println "我叫$name，今年$age岁，来自$city"
    }
    
    def greet(other) {
        println "$name向$other打招呼"
    }
}

// 创建对象
def person1 = new Person("张三", 25)
def person2 = new Person("李四", 30)

// 调用方法
person1.introduce()
person1.greet("李四")

// 属性访问
println person1.name
person1.city = "上海"
```

### 6.2 继承和多态

```groovy
// 父类
class Animal {
    String name
    
    Animal(name) {
        this.name = name
    }
    
    def makeSound() {
        println "$name发出声音"
    }
}

// 子类
class Dog extends Animal {
    String breed
    
    Dog(name, breed) {
        super(name)
        this.breed = breed
    }
    
    @Override
    def makeSound() {
        println "$name（$breed）在汪汪叫"
    }
    
    def fetch() {
        println "$name在捡球"
    }
}

class Cat extends Animal {
    Cat(name) {
        super(name)
    }
    
    @Override
    def makeSound() {
        println "$name在喵喵叫"
    }
}

// 使用多态
def animals = [
    new Dog("旺财", "金毛"),
    new Cat("小咪"),
    new Dog("大黄", "土狗")
]

animals.each { animal ->
    animal.makeSound()  // 多态调用
}
```

### 6.3 接口和特征

```groovy
// 定义特征（类似接口）
trait Flyable {
    def fly() {
        println "${this.class.simpleName}在飞行"
    }
}

trait Swimnable {
    def swim() {
        println "${this.class.simpleName}在游泳"
    }
}

// 实现特征
class Duck implements Flyable, Swimnable {
    String name
    
    Duck(name) {
        this.name = name
    }
}

class Fish implements Swimnable {
    String species
    
    Fish(species) {
        this.species = species
    }
}

// 使用
def duck = new Duck("唐老鸭")
duck.fly()
duck.swim()

def fish = new Fish("金鱼")
fish.swim()
```

---

## 第7章 元编程

### 7.1 动态方法调用

```groovy
// 动态添加方法
String.metaClass.isPalindrome = {
    delegate.toLowerCase() == delegate.toLowerCase().reverse()
}

println "madam".isPalindrome()  // true
println "hello".isPalindrome()  // false

// 动态属性
class DynamicPerson {
    def propertyMissing(String name) {
        return "属性 $name 不存在"
    }
    
    def methodMissing(String name, args) {
        println "调用了不存在的方法: $name，参数: $args"
    }
}

def dp = new DynamicPerson()
println dp.unknownProperty  // 动态属性访问
dp.unknownMethod("参数1", "参数2")  // 动态方法调用
```

### 7.2 AST转换

```groovy
// @ToString注解
import groovy.transform.ToString

@ToString
class Book {
    String title
    String author
    double price
}

def book = new Book(title: "Groovy实战", author: "张三", price: 59.9)
println book  // 自动生成toString方法

// @EqualsAndHashCode注解
import groovy.transform.EqualsAndHashCode

@EqualsAndHashCode
class Product {
    String name
    String category
}

// @Immutable注解（不可变类）
import groovy.transform.Immutable

@Immutable
class Point {
    double x
    double y
}

def point = new Point(3.0, 4.0)
// point.x = 5.0  // 编译错误，不可修改
```

---

## 第8章 字符串处理

### 8.1 字符串基础操作

```groovy
def text = "Hello Groovy World"

// 基础方法
println text.length()        // 长度
println text.toLowerCase()   // 转小写
println text.toUpperCase()   // 转大写
println text.trim()          // 去除首尾空格

// 查找和替换
println text.contains("Groovy")     // 包含检查
println text.startsWith("Hello")   // 开头检查
println text.endsWith("World")     // 结尾检查
println text.indexOf("Groovy")     // 查找位置
println text.replace("World", "Universe")  // 替换

// 分割和连接
def words = text.split(" ")
println words.join("-")

// 字符串插值
def name = "张三"
def age = 25
def message = "我叫${name}，今年${age}岁"
```

### 8.2 字符串高级操作

```groovy
// GString（可插值字符串）
def username = "admin"
def sql = "SELECT * FROM users WHERE username = '${username}'"

// 多行字符串格式化
def template = """
用户信息：
姓名：${name}
年龄：${age}
城市：${city}
"""

// 字符串作为模板
def template2 = 'Hello ${name}!'
def engine = new groovy.text.SimpleTemplateEngine()
def binding = [name: "World"]
println engine.createTemplate(template2).make(binding)
```

---

## 第9章 文件操作

### 9.1 文件读取

```groovy
// 读取整个文件
def content = new File("test.txt").text
println content

// 按行读取
new File("test.txt").eachLine { line, number ->
    println "$number: $line"
}

// 读取为列表
def lines = new File("test.txt").readLines()

// 安全读取（检查文件存在）
def file = new File("test.txt")
if (file.exists()) {
    println file.text
} else {
    println "文件不存在"
}
```

### 9.2 文件写入

```groovy
// 写入文本
new File("output.txt").text = "Hello World!"

// 追加内容
new File("output.txt") << "新的一行\n"

// 写入列表
def data = ["第一行", "第二行", "第三行"]
new File("lines.txt").write(data.join("\n"))

// 使用Writer
new File("data.txt").withWriter { writer ->
    writer.writeLine("标题")
    writer.writeLine("内容")
}
```

### 9.3 目录操作

```groovy
// 创建目录
new File("newDir").mkdir()
new File("path/to/dir").mkdirs()  // 创建多级目录

// 遍历目录
def dir = new File(".")
dir.eachFile { file ->
    println "文件: ${file.name}"
}

// 递归遍历
dir.eachFileRecurse { file ->
    if (file.isFile()) {
        println "文件: ${file.absolutePath}"
    }
}

// 过滤文件
dir.eachFileMatch(~/.*.txt/) { file ->
    println "文本文件: ${file.name}"
}
```

---

## 第10章 正则表达式

### 10.1 正则基础

```groovy
// 创建正则表达式
def pattern1 = ~/\d+/              // 数字模式
def pattern2 = /[a-zA-Z]+/         // 字母模式
def pattern3 = "\\w+".toPattern()  // 字符串转模式

// 匹配检查
def text = "用户ID: 12345"
if (text ==~ /.*\d+.*/) {
    println "包含数字"
}

// 查找匹配
def matcher = text =~ /\d+/
if (matcher.find()) {
    println "找到数字: ${matcher[0]}"
}

// 全部匹配
def numbers = "电话: 138-1234-5678, 座机: 010-12345678"
def phonePattern = /\d{3}-?\d{4}-?\d{4}/
def allMatches = numbers.findAll(phonePattern)
println "找到的电话号码: $allMatches"
```

### 10.2 正则替换

```groovy
def text = "Hello World 123"

// 简单替换
def result1 = text.replaceAll(/\d+/, "数字")
println result1  // "Hello World 数字"

// 使用捕获组
def phoneText = "联系电话：138-1234-5678"
def formatted = phoneText.replaceAll(/(\d{3})-(\d{4})-(\d{4})/) { match, area, prefix, suffix ->
    "($area) $prefix-$suffix"
}
println formatted  // "联系电话：(138) 1234-5678"
```

---

## 第11章 构建器模式

### 11.1 内置构建器

```groovy
// MarkupBuilder - 生成HTML/XML
import groovy.xml.MarkupBuilder

def writer = new StringWriter()
def html = new MarkupBuilder(writer)

html.html {
    head {
        title("我的网页")
    }
    body {
        h1("欢迎")
        p("这是使用Groovy生成的HTML")
        ul {
            li("项目1")
            li("项目2")
            li("项目3")
        }
    }
}

println writer.toString()

// JsonBuilder - 生成JSON
import groovy.json.JsonBuilder

def json = new JsonBuilder()
json {
    name "张三"
    age 25
    address {
        city "北京"
        district "朝阳区"
    }
    hobbies(["编程", "读书", "旅行"])
}

println json.toPrettyString()
```

### 11.2 自定义构建器

```groovy
// 自定义DSL构建器
class EmailBuilder {
    def to
    def from  
    def subject
    def body
    
    def to(recipient) {
        this.to = recipient
        return this
    }
    
    def from(sender) {
        this.from = sender
        return this
    }
    
    def subject(subject) {
        this.subject = subject
        return this
    }
    
    def body(content) {
        this.body = content
        return this
    }
    
    def send() {
        println """
发送邮件:
收件人: $to
发件人: $from
主题: $subject
内容: $body
        """
    }
    
    // DSL方法
    static def email(closure) {
        def builder = new EmailBuilder()
        closure.delegate = builder
        closure.resolveStrategy = Closure.DELEGATE_FIRST
        closure.call()
        return builder
    }
}

// 使用DSL
EmailBuilder.email {
    to "user@example.com"
    from "admin@company.com"
    subject "欢迎使用Groovy"
    body "这是一封使用Groovy DSL生成的邮件"
}.send()
```

---

## 第12章 JSON和XML处理

### 12.1 JSON处理

```groovy
import groovy.json.JsonSlurper
import groovy.json.JsonBuilder

// 解析JSON
def jsonText = '''
{
    "name": "张三",
    "age": 25,
    "hobbies": ["编程", "读书"],
    "address": {
        "city": "北京",
        "district": "海淀区"
    }
}
'''

def slurper = new JsonSlurper()
def data = slurper.parseText(jsonText)

println data.name           // 访问属性
println data.hobbies[0]     // 访问数组
println data.address.city   // 访问嵌套对象

// 生成JSON
def person = [
    name: "李四",
    age: 30,
    skills: ["Java", "Groovy", "Python"]
]

def builder = new JsonBuilder(person)
println builder.toPrettyString()

// 从网络获取JSON
def url = "https://api.github.com/users/groovy"
// def response = new URL(url).text
// def userData = slurper.parseText(response)
```

### 12.2 XML处理

```groovy
import groovy.xml.XmlSlurper

// 解析XML
def xmlText = '''
<books>
    <book id="1">
        <title>Groovy实战</title>
        <author>张三</author>
        <price>59.9</price>
    </book>
    <book id="2">
        <title>Java编程思想</title>
        <author>Bruce Eckel</author>
        <price>89.0</price>
    </book>
</books>
'''

def books = new XmlSlurper().parseText(xmlText)

// 访问XML数据
books.book.each { book ->
    println "书名: ${book.title}"
    println "作者: ${book.author}"
    println "价格: ${book.price}"
    println "ID: ${book.@id}"  // 访问属性
    println "---"
}

// 查找特定元素
def expensiveBooks = books.book.findAll { 
    it.price.toDouble() > 60 
}
```

---

## 第13章 数据库操作

### 13.1 基础数据库连接

```groovy
@Grab('com.h2database:h2:2.1.214')
import groovy.sql.Sql

// 连接H2内存数据库
def sql = Sql.newInstance("jdbc:h2:mem:testdb", 
                         "sa", "", "org.h2.Driver")

// 创建表
sql.execute('''
    CREATE TABLE users (
        id INT PRIMARY KEY AUTO_INCREMENT,
        name VARCHAR(100),
        email VARCHAR(100),
        age INT
    )
''')

// 插入数据
sql.execute("INSERT INTO users (name, email, age) VALUES (?, ?, ?)", 
           ["张三", "zhangsan@email.com", 25])

// 批量插入
def users = [
    ["李四", "lisi@email.com", 30],
    ["王五", "wangwu@email.com", 28]
]
sql.withBatch(20, "INSERT INTO users (name, email, age) VALUES (?, ?, ?)") { stmt ->
    users.each { user ->
        stmt.addBatch(user)
    }
}
```

### 13.2 查询和事务

```groovy
// 查询数据
def results = sql.rows("SELECT * FROM users WHERE age > ?", [20])
results.each { row ->
    println "姓名: ${row.name}, 邮箱: ${row.email}, 年龄: ${row.age}"
}

// 单行查询
def user = sql.firstRow("SELECT * FROM users WHERE name = ?", ["张三"])
if (user) {
    println "找到用户: ${user.name}"
}

// 事务操作
sql.withTransaction {
    sql.execute("UPDATE users SET age = age + 1")
    sql.execute("INSERT INTO users (name, email, age) VALUES (?, ?, ?)", 
               ["新用户", "new@email.com", 20])
}

// 关闭连接
sql.close()
```

---

## 第14章 Web开发

### 14.1 Ratpack Web框架

```groovy
@Grab('io.ratpack:ratpack-groovy:1.9.0')
import static ratpack.groovy.Groovy.ratpack

ratpack {
    handlers {
        get {
            render "Hello Groovy Web!"
        }
        
        get("user/:name") { ctx ->
            def name = ctx.getPathTokens().name
            render "Hello, $name!"
        }
        
        post("api/user") { ctx ->
            ctx.parse(Map).then { data ->
                // 处理POST数据
                ctx.render("创建用户: ${data.name}")
            }
        }
        
        get("json") {
            render([
                message: "Hello JSON",
                timestamp: new Date(),
                data: [1, 2, 3, 4, 5]
            ])
        }
    }
}
```

### 14.2 RESTful API示例

```groovy
// 用户管理API
class UserController {
    static def users = [
        [id: 1, name: "张三", email: "zhangsan@email.com"],
        [id: 2, name: "李四", email: "lisi@email.com"]
    ]
    
    static def getUsers() {
        return users
    }
    
    static def getUser(id) {
        return users.find { it.id == id as Integer }
    }
    
    static def createUser(userData) {
        def newId = users.size() + 1
        def newUser = [id: newId] + userData
        users << newUser
        return newUser
    }
    
    static def updateUser(id, userData) {
        def user = getUser(id)
        if (user) {
            user.putAll(userData)
        }
        return user
    }
    
    static def deleteUser(id) {
        users.removeAll { it.id == id as Integer }
    }
}

// 在Ratpack中使用
ratpack {
    handlers {
        path("api/users") {
            byMethod {
                get {
                    render UserController.getUsers()
                }
                post { ctx ->
                    ctx.parse(Map).then { data ->
                        def user = UserController.createUser(data)
                        ctx.render(user)
                    }
                }
            }
        }
        
        path("api/users/:id") { ctx ->
            def id = ctx.getPathTokens().id
            byMethod {
                get {
                    def user = UserController.getUser(id)
                    if (user) {
                        render user
                    } else {
                        clientError(404)
                    }
                }
                put { ctx ->
                    ctx.parse(Map).then { data ->
                        def user = UserController.updateUser(id, data)
                        ctx.render(user)
                    }
                }
                delete {
                    UserController.deleteUser(id)
                    render "用户已删除"
                }
            }
        }
    }
}
```

---

## 第15章 测试框架

### 15.1 Spock测试框架

```groovy
@Grab('org.spockframework:spock-core:2.3-groovy-4.0')
import spock.lang.Specification

// 待测试的类
class Calculator {
    def add(a, b) { a + b }
    def subtract(a, b) { a - b }
    def multiply(a, b) { a * b }
    def divide(a, b) {
        if (b == 0) throw new ArithmeticException("除零错误")
        return a / b
    }
}

// Spock测试规范
class CalculatorSpec extends Specification {
    
    def calculator = new Calculator()
    
    def "加法测试"() {
        when:
        def result = calculator.add(2, 3)
        
        then:
        result == 5
    }
    
    def "减法测试"() {
        expect:
        calculator.subtract(a, b) == expected
        
        where:
        a | b | expected
        5 | 3 | 2
        1 | 1 | 0
        0 | 5 | -5
    }
    
    def "除零异常测试"() {
        when:
        calculator.divide(10, 0)
        
        then:
        thrown(ArithmeticException)
    }
    
    def "多个断言测试"() {
        when:
        def result = calculator.multiply(3, 4)
        
        then:
        result == 12
        result > 10
        result instanceof Integer
    }
}
```

### 15.2 Mock和Stub

```groovy
import spock.lang.Specification

// 服务类
class UserService {
    def userRepository
    
    def findUser(id) {
        return userRepository.findById(id)
    }
    
    def saveUser(user) {
        if (!user.email) {
            throw new IllegalArgumentException("邮箱不能为空")
        }
        return userRepository.save(user)
    }
}

class UserServiceSpec extends Specification {
    
    def userRepository = Mock()  // 创建Mock对象
    def userService = new UserService(userRepository: userRepository)
    
    def "查找用户测试"() {
        given:
        def userId = 1
        def expectedUser = [id: 1, name: "张三"]
        
        when:
        def result = userService.findUser(userId)
        
        then:
        1 * userRepository.findById(userId) >> expectedUser  // Mock行为
        result == expectedUser
    }
    
    def "保存用户异常测试"() {
        given:
        def invalidUser = [name: "李四"]  // 没有email
        
        when:
        userService.saveUser(invalidUser)
        
        then:
        thrown(IllegalArgumentException)
        0 * userRepository.save(_)  // 确保save方法没有被调用
    }
}
```

---

## 第16章 Gradle构建

### 16.1 build.gradle配置

```groovy
// 基础配置
plugins {
    id 'groovy'
    id 'application'
}

group = 'com.example'
version = '1.0.0'

repositories {
    mavenCentral()
}

dependencies {
    // Groovy核心
    implementation 'org.codehaus.groovy:groovy-all:4.0.15'
    
    // 测试框架
    testImplementation 'org.spockframework:spock-core:2.3-groovy-4.0'
    
    // Web框架
    implementation 'io.ratpack:ratpack-groovy:1.9.0'
    
    // 数据库
    implementation 'com.h2database:h2:2.1.214'
    
    // JSON处理
    implementation 'com.fasterxml.jackson.core:jackson-databind:2.15.2'
}

application {
    mainClass = 'com.example.App'
}

// 自定义任务
task hello {
    doLast {
        println "Hello from Gradle!"
    }
}

// 运行Groovy脚本任务
task runScript(type: JavaExec) {
    classpath = sourceSets.main.runtimeClasspath
    main = 'groovy.ui.GroovyMain'
    args 'scripts/myScript.groovy'
}
```

### 16.2 Gradle脚本

```groovy
// 在build.gradle中的Groovy脚本示例

// 环境配置
ext {
    profiles = [
        dev: [
            dbUrl: 'jdbc:h2:mem:devdb',
            logLevel: 'DEBUG'
        ],
        prod: [
            dbUrl: 'jdbc:mysql://prod-server:3306/mydb',
            logLevel: 'WARN'
        ]
    ]
}

// 根据环境生成配置文件
task generateConfig {
    doLast {
        def profile = project.hasProperty('profile') ? project.profile : 'dev'
        def config = profiles[profile]
        
        def configFile = file("src/main/resources/application.properties")
        configFile.text = """
database.url=${config.dbUrl}
logging.level=${config.logLevel}
app.name=${project.name}
app.version=${project.version}
"""
        println "为环境 '$profile' 生成配置文件"
    }
}
```

---

## 第17章 高级特性

### 17.1 分类（Categories）

```groovy
// 定义分类
class StringExtensions {
    static String reverse(String self) {
        return self.reverse()
    }
    
    static boolean isPalindrome(String self) {
        def cleaned = self.toLowerCase().replaceAll(/[^a-z]/, '')
        return cleaned == cleaned.reverse()
    }
    
    static String encrypt(String self) {
        return self.collect { char ->
            (char as char) + 1
        }.join('')
    }
}

// 使用分类
use(StringExtensions) {
    println "hello".reverse()      // olleh
    println "madam".isPalindrome() // true
    println "abc".encrypt()        // bcd
}
```

### 17.2 运算符重载

```groovy
class Money {
    BigDecimal amount
    String currency
    
    Money(amount, currency = "CNY") {
        this.amount = amount as BigDecimal
        this.currency = currency
    }
    
    // 重载 + 运算符
    def plus(Money other) {
        if (this.currency != other.currency) {
            throw new IllegalArgumentException("货币类型不匹配")
        }
        return new Money(this.amount + other.amount, this.currency)
    }
    
    // 重载 - 运算符
    def minus(Money other) {
        if (this.currency != other.currency) {
            throw new IllegalArgumentException("货币类型不匹配")
        }
        return new Money(this.amount - other.amount, this.currency)
    }
    
    // 重载 * 运算符
    def multiply(Number factor) {
        return new Money(this.amount * factor, this.currency)
    }
    
    String toString() {
        return "${amount} ${currency}"
    }
}

// 使用运算符重载
def money1 = new Money(100)
def money2 = new Money(50)

println money1 + money2  // 150 CNY
println money1 - money2  // 50 CNY
println money1 * 2       // 200 CNY
```

### 17.3 Domain-Specific Language (DSL)

```groovy
// 配置DSL示例
class DatabaseConfig {
    def host
    def port
    def database
    def username
    def password
    def options = [:]
    
    def host(value) { this.host = value }
    def port(value) { this.port = value }
    def database(value) { this.database = value }
    def username(value) { this.username = value }
    def password(value) { this.password = value }
    
    def option(key, value) {
        options[key] = value
    }
    
    def getConnectionString() {
        def baseUrl = "jdbc:mysql://$host:$port/$database"
        if (options) {
            def params = options.collect { k, v -> "$k=$v" }.join("&")
            baseUrl += "?$params"
        }
        return baseUrl
    }
    
    // DSL入口方法
    static def configure(closure) {
        def config = new DatabaseConfig()
        closure.delegate = config
        closure.resolveStrategy = Closure.DELEGATE_FIRST
        closure.call()
        return config
    }
}

// 使用DSL配置数据库
def dbConfig = DatabaseConfig.configure {
    host 'localhost'
    port 3306
    database 'myapp'
    username 'root'
    password 'password'
    option 'useSSL', 'false'
    option 'characterEncoding', 'utf8'
}

println "连接字符串: ${dbConfig.connectionString}"
```

---

## 🎯 学习路径建议

### 初学者路径（1-4周）
1. **第1-2章**: 掌握基础语法和数据类型
2. **第3-4章**: 学会控制结构和集合操作
3. **第5章**: 理解函数和闭包概念（Groovy核心）
4. **练习**: 编写简单脚本，熟悉语法

### 进阶路径（5-8周）
1. **第6章**: 掌握面向对象编程
2. **第7章**: 学习元编程特性（Groovy特色）
3. **第8-10章**: 熟练文本处理和文件操作
4. **练习**: 编写实用脚本，解决实际问题

### 高级路径（9-12周）
1. **第11章**: 学会构建器模式和DSL设计
2. **第12-13章**: 掌握数据处理技能
3. **第14章**: 学习Web开发
4. **第15章**: 掌握测试驱动开发
5. **练习**: 开发小型Web应用

### 专家路径（13周+）
1. **第16章**: 精通Gradle构建工具
2. **第17章**: 掌握高级特性和DSL设计
3. **项目实战**: 开发复杂应用和工具
4. **持续学习**: 跟进Groovy新版本特性

---

## 💡 学习技巧

### 1. 实践为主
- 每个代码示例都要亲自运行
- 修改示例代码，观察结果变化
- 解决实际问题，而不是纯粹背语法

### 2. 对比学习
- 如果您会Java，对比Groovy的简洁语法
- 体验动态语言的灵活性
- 理解何时使用静态类型，何时使用动态类型

### 3. 工具应用
- 多使用groovysh交互式shell
- 利用groovyConsole进行快速实验
- 使用IDE的代码提示和调试功能

### 4. 社区资源
- 阅读Groovy官方文档
- 参与Groovy社区讨论
- 学习优秀的Groovy项目代码

---

## 🔧 常用工具和命令

```bash
# Groovy交互式shell
groovysh

# Groovy控制台（GUI）
groovyConsole

# 运行Groovy脚本
groovy myScript.groovy

# 编译Groovy类
groovyc MyClass.groovy

# 查看Groovy版本
groovy -version

# 安装依赖并运行（使用@Grab注解）
groovy -cp "lib/*" myScript.groovy
```

---

## 📚 推荐学习资源

1. **官方文档**: [http://groovy-lang.org/documentation.html](http://groovy-lang.org/documentation.html)
2. **Groovy in Action** - 经典Groovy书籍
3. **Making Java Groovy** - Java开发者的Groovy指南
4. **Spock Framework文档**: [http://spockframework.org/](http://spockframework.org/)
5. **Gradle用户指南**: [https://docs.gradle.org/](https://docs.gradle.org/)

---

## 🎉 结语

Groovy是一门优雅而强大的语言，它继承了Java的稳定性，又拥有脚本语言的灵活性。通过系统学习本指南，您将掌握从基础语法到高级特性的全部知识，成为Groovy开发专家！

记住：**多写代码，多做实验，多解决实际问题** - 这是成为专家的唯一路径！

开始您的Groovy专家之旅吧！🚀 